import json
import os


def __in_map(_map):
    def __decorator(func):
        def __my_in_map(pid, bid) -> bool:
            if pid in _map:
                return str(bid) in _map[pid]
            return False

        return __my_in_map

    return __decorator


__single_function_map = {
    'Chart': {'1',
              '10',
              '11',
              '12',
              '13',
              '17',
              '20',
              '24',
              '26',
              '3',
              '4',
              '5',
              '6',
              '7',
              '8',
              '9'},
    'Cli': {'11',
            '12',
            '14',
            '15',
            '17',
            '19',
            '2',
            '20',
            '23',
            '24',
            '25',
            '26',
            '27',
            '28',
            '29',
            '32',
            '35',
            '37',
            '38',
            '4',
            '40',
            '5',
            '8',
            '9'},
    'Closure': {'1',
                '10',
                '101',
                '102',
                '104',
                '105',
                '107',
                '109',
                '11',
                '111',
                '112',
                '113',
                '114',
                '115',
                '116',
                '117',
                '118',
                '119',
                '12',
                '120',
                '121',
                '122',
                '123',
                '124',
                '125',
                '126',
                '128',
                '129',
                '13',
                '130',
                '131',
                '132',
                '133',
                '14',
                '145',
                '146',
                '147',
                '15',
                '150',
                '152',
                '159',
                '160',
                '161',
                '164',
                '166',
                '168',
                '17',
                '172',
                '176',
                '18',
                '19',
                '2',
                '20',
                '21',
                '22',
                '23',
                '24',
                '25',
                '29',
                '31',
                '32',
                '33',
                '35',
                '36',
                '38',
                '39',
                '4',
                '40',
                '42',
                '44',
                '46',
                '48',
                '5',
                '50',
                '51',
                '52',
                '53',
                '55',
                '56',
                '57',
                '58',
                '59',
                '61',
                '62',
                '65',
                '66',
                '67',
                '69',
                '7',
                '70',
                '71',
                '73',
                '77',
                '78',
                '81',
                '82',
                '83',
                '86',
                '87',
                '88',
                '90',
                '91',
                '92',
                '94',
                '95',
                '96',
                '97',
                '99'},
    'Codec': {'10', '15', '17', '18', '2', '3', '4', '5', '6', '7', '9'},
    'Collections': {'26'},
    'Compress': {'1',
                 '10',
                 '11',
                 '12',
                 '13',
                 '14',
                 '15',
                 '16',
                 '17',
                 '18',
                 '19',
                 '21',
                 '23',
                 '24',
                 '25',
                 '26',
                 '27',
                 '28',
                 '30',
                 '31',
                 '32',
                 '35',
                 '36',
                 '37',
                 '38',
                 '40',
                 '41',
                 '44',
                 '45',
                 '46',
                 '5',
                 '7',
                 '8'},
    'Csv': {'1', '10', '11', '14', '15', '2', '3', '4', '5', '6', '9'},
    'Gson': {'11', '12', '13', '15', '17', '18', '5', '6'},
    'JacksonCore': {'11',
                    '15',
                    '20',
                    '21',
                    '23',
                    '25',
                    '26',
                    '3',
                    '4',
                    '5',
                    '6',
                    '7',
                    '8'},
    'JacksonDatabind': {'1',
                        '100',
                        '101',
                        '102',
                        '107',
                        '11',
                        '112',
                        '12',
                        '16',
                        '17',
                        '19',
                        '24',
                        '27',
                        '28',
                        '33',
                        '34',
                        '35',
                        '37',
                        '39',
                        '42',
                        '44',
                        '45',
                        '46',
                        '47',
                        '49',
                        '5',
                        '51',
                        '54',
                        '57',
                        '58',
                        '6',
                        '62',
                        '64',
                        '67',
                        '7',
                        '70',
                        '71',
                        '74',
                        '76',
                        '8',
                        '82',
                        '83',
                        '85',
                        '88',
                        '9',
                        '91',
                        '93',
                        '96',
                        '97',
                        '98',
                        '99'},
    'JacksonXml': {'1', '3', '4', '5'},
    'Jsoup': {'1',
              '10',
              '13',
              '15',
              '19',
              '2',
              '20',
              '24',
              '26',
              '27',
              '32',
              '33',
              '34',
              '35',
              '37',
              '38',
              '39',
              '4',
              '40',
              '41',
              '42',
              '43',
              '45',
              '46',
              '47',
              '48',
              '49',
              '5',
              '50',
              '51',
              '53',
              '54',
              '55',
              '57',
              '59',
              '6',
              '61',
              '62',
              '64',
              '68',
              '70',
              '72',
              '75',
              '76',
              '77',
              '80',
              '82',
              '84',
              '85',
              '86',
              '88',
              '89',
              '90',
              '93'},
    'JxPath': {'10', '12', '21', '22', '5', '6', '8'},
    'Lang': {'1',
             '10',
             '11',
             '12',
             '14',
             '16',
             '17',
             '18',
             '19',
             '21',
             '22',
             '24',
             '26',
             '27',
             '28',
             '29',
             '3',
             '31',
             '33',
             '37',
             '38',
             '39',
             '40',
             '42',
             '43',
             '44',
             '45',
             '48',
             '49',
             '5',
             '51',
             '52',
             '53',
             '54',
             '55',
             '57',
             '58',
             '59',
             '6',
             '61',
             '65',
             '9'},
    'Math': {'10',
             '101',
             '102',
             '103',
             '105',
             '106',
             '11',
             '13',
             '17',
             '19',
             '2',
             '20',
             '21',
             '22',
             '23',
             '24',
             '25',
             '26',
             '27',
             '28',
             '3',
             '30',
             '31',
             '32',
             '33',
             '34',
             '38',
             '39',
             '40',
             '41',
             '42',
             '43',
             '44',
             '45',
             '48',
             '5',
             '50',
             '51',
             '52',
             '53',
             '55',
             '56',
             '57',
             '58',
             '59',
             '60',
             '63',
             '64',
             '69',
             '7',
             '70',
             '72',
             '73',
             '74',
             '75',
             '78',
             '79',
             '8',
             '80',
             '82',
             '84',
             '85',
             '86',
             '87',
             '88',
             '89',
             '9',
             '90',
             '91',
             '94',
             '95',
             '96',
             '97',
             '98'},
    'Mockito': {'1',
                '12',
                '13',
                '18',
                '20',
                '22',
                '24',
                '27',
                '28',
                '29',
                '33',
                '34',
                '38',
                '5',
                '7',
                '8'},
    'Time': {'14',
             '15',
             '16',
             '17',
             '18',
             '19',
             '20',
             '22',
             '23',
             '24',
             '25',
             '27',
             '4',
             '5',
             '7',
             '8'}
}


@__in_map(__single_function_map)
def is_single_function_bug(pid, bid) -> bool:
    pass


__giant_repair = {
    'Cli': {'17', '19', '28', '37', '40', '9', '32'},
    'Closure': {'10',
                '101',
                '104',
                '11',
                '113',
                '115',
                '117',
                '118',
                '125',
                '126',
                '128',
                '13',
                '15',
                '161',
                '168',
                '19',
                '2',
                '20',
                '21',
                '33',
                '36',
                '44',
                '5',
                '52',
                '55',
                '56',
                '57',
                '61',
                '62',
                '70',
                '73',
                '78',
                '86',
                '92'},
    'Codec': {'10', '18', '2', '5', '6', '7', '9', '4'},
    'Compress': {'19', '21', '23', '25', '32', '44', '45', '46', '7', '1', '27', '31'},
    'Csv': {'10', '11', '4', '5', '6', '9'},
    'Gson': {'11', '12', '15', '16', '18', '6'},
    'JacksonCore': {'25', '3', '5', '6', '8', '11', '20', '7'},
    'JacksonDatabind': {'1',
                        '12',
                        '16',
                        '34',
                        '42',
                        '46',
                        '49',
                        '5',
                        '54',
                        '57',
                        '70',
                        '83',
                        '91',
                        '97',
                        '99'},
    'Jsoup': {'20',
              '26',
              '32',
              '33',
              '39',
              '40',
              '43',
              '45',
              '48',
              '51',
              '55',
              '57',
              '59',
              '6',
              '68',
              '80',
              '90',
              '24'},
    'JxPath': {'8'},
    'Jacksonxml': {'5'},
    'Chart': {'1', '11', '12', '20', '24', '4', '7', '8'},
    'Lang': {'10',
             '14',
             '17',
             '21',
             '31',
             '33',
             '43',
             '45',
             '51',
             '52',
             '55',
             '57',
             '59'},
    'Math': {'10',
             '101',
             '106',
             '11',
             '2',
             '25',
             '27',
             '30',
             '34',
             '41',
             '48',
             '56',
             '57',
             '58',
             '59',
             '69',
             '70',
             '72',
             '75',
             '79',
             '82',
             '85',
             '86',
             '94',
             '95',
             '96'},
    'Mockito': {'12', '24', '29', '33', '34', '38'},
    'Time': {'15'}}


@__in_map(__giant_repair)
def can_giant_repair_fix(pid, bid) -> bool:
    pass


def is_d4j_1_2(pid, bid) -> bool:
    if pid in ['Chart', 'Lang', 'Math', 'Mockito', 'Time']:
        return True
    if pid == 'Closure':
        return int(bid) <= 133


with open(os.path.join(os.path.dirname(__file__), "baseline_data/12_perfect_result.json"), "r") as _f:
    __12_perfect = json.load(_f)
with open(os.path.join(os.path.dirname(__file__), "baseline_data/12_sbfl_result.json"), "r") as _f:
    __12_sbfl = json.load(_f)
with open(os.path.join(os.path.dirname(__file__), "baseline_data/20_perfect_result.json"), "r") as _f:
    __20_perfect = json.load(_f)
__all_projects = set(__12_sbfl.keys()).union(__20_perfect.keys()).union(__12_perfect.keys())


def get_baseline_project_names():
    return __all_projects


def can_fix(baseline_name, pid, bid) -> bool:
    _version_str = f"{pid}_{bid}"
    if baseline_name in __12_perfect and _version_str in __12_perfect[baseline_name]['bugs']:
        return True
    if baseline_name in __20_perfect and _version_str in __20_perfect[baseline_name]['bugs']:
        return True
    if baseline_name in __12_sbfl and _version_str in __12_sbfl[baseline_name]['bugs']:
        return True
    return False


if __name__ == '__main__':
    assert is_single_function_bug('Chart', 1)
    assert not is_single_function_bug('Chart', 14)
